<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ç‚¹èŒ¶æ­¥éª¤è¯¦è§£">
    <title>ç‚¹èŒ¶æ­¥éª¤ - æ¢¦åå¯»èŒ¶å½•</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- äº’åŠ¨æ­¥éª¤é¡µ - æ”¯æŒæ¨ªå‘æ»‘åŠ¨çš„å­é¡µé¢ -->
        <section class="roast-tea" aria-labelledby="roast-title">
            <h2 id="roast-title">ç‚¹èŒ¶æ­¥éª¤</h2>
            
            <!-- æ»‘åŠ¨å®¹å™¨ -->
            <div class="slide-container" role="region" aria-label="ç‚¹èŒ¶æ­¥éª¤å±•ç¤º">
                <div class="slide-track">
                    <!-- å­é¡µé¢1ï¼šç‚™èŒ¶ -->
                    <div class="slide-item" id="slide-0">
                        <h3>ç‚™èŒ¶</h3>
                        <div class="teapot-illustration">
                            <div class="draggable" style="font-size: 2rem;" draggable="true">ğŸ«–</div>
                        </div>
                        <div class="hint-box">å°†å›¢èŒ¶ç”¨å¾®ç«çƒ˜çƒ¤ï¼Œå»é™¤æ°´åˆ†</div>
                    </div>
                    
                    <!-- å­é¡µé¢2ï¼šç¢¾èŒ¶ -->
                    <div class="slide-item" id="slide-1">
                        <h3>ç¢¾èŒ¶</h3>
                        <div class="teapot-illustration">
                            <div class="draggable" style="font-size: 2rem;" draggable="true">ğŸª“</div>
                        </div>
                        <div class="hint-box">å°†çƒ¤å¥½çš„èŒ¶é¥¼ç¢¾ç¢æˆå°å—</div>
                    </div>
                    
                    <!-- å­é¡µé¢3ï¼šç£¨èŒ¶ -->
                    <div class="slide-item" id="slide-2">
                        <h3>ç£¨èŒ¶</h3>
                        <div class="teapot-illustration">
                            <div class="draggable" style="font-size: 2rem;" draggable="true">ğŸ«˜</div>
                        </div>
                        <div class="hint-box">ç”¨èŒ¶ç£¨å°†èŒ¶å—ç£¨æˆç»†è…»çš„èŒ¶ç²‰</div>
                    </div>
                    
                    <!-- å­é¡µé¢4ï¼šèŒ¶ç›’ -->
                    <div class="slide-item" id="slide-3">
                        <h3>èŒ¶ç›’</h3>
                        <div class="teapot-illustration">
                            <div class="draggable" style="font-size: 2rem;" draggable="true">ğŸ“¦</div>
                        </div>
                        <div class="hint-box">å°†èŒ¶ç²‰è£…å…¥èŒ¶ç›’ä¸­å¤‡ç”¨</div>
                    </div>
                </div>
                
                <!-- æ»‘åŠ¨æ§åˆ¶æŒ‰é’® -->
                <button class="slide-control prev" aria-label="ä¸Šä¸€æ­¥">â€¹</button>
                <button class="slide-control next" aria-label="ä¸‹ä¸€æ­¥">â€º</button>
            </div>
            
            <!-- æ»‘åŠ¨æŒ‡ç¤ºå™¨ -->
            <div class="slide-indicators" role="tablist" aria-label="æ­¥éª¤å¯¼èˆª">
                <div class="indicator active" data-index="0" role="tab" aria-selected="true" aria-controls="slide-0" tabindex="0"></div>
                <div class="indicator" data-index="1" role="tab" aria-selected="false" aria-controls="slide-1" tabindex="0"></div>
                <div class="indicator" data-index="2" role="tab" aria-selected="false" aria-controls="slide-2" tabindex="0"></div>
                <div class="indicator" data-index="3" role="tab" aria-selected="false" aria-controls="slide-3" tabindex="0"></div>
            </div>
            
            <!-- å·¥å…·é€‰æ‹© -->
            <div class="tool-selection" role="group" aria-label="é€‰æ‹©å·¥å…·">
                <div class="tool-item" data-tool="ç‚™èŒ¶" role="button" tabindex="0">ç‚™èŒ¶</div>
                <div class="tool-item" data-tool="ç¢¾èŒ¶" role="button" tabindex="0">ç¢¾èŒ¶</div>
                <div class="tool-item" data-tool="ç£¨èŒ¶" role="button" tabindex="0">ç£¨èŒ¶</div>
                <div class="tool-item" data-tool="èŒ¶ç›’" role="button" tabindex="0">èŒ¶ç›’</div>
            </div>
            
            <div style="text-align: center; margin-top: 50px;">
                <a href="4ChaBaiXi.html" class="nav-btn" aria-label="å‰å¾€ä¸‹ä¸€æ­¥">ç»§ç»­ä½“éªŒ â†’</a>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <a href="2JianJie.html" class="nav-btn" aria-label="è¿”å›ä¸Šä¸€æ­¥">â† è¿”å›ä¸Šä¸€é¡µ</a>
            </div>
        </section>
    </div>
    
    <script>
        // é¡µé¢å†…äº¤äº’é€»è¾‘ - æ»‘åŠ¨åŠŸèƒ½å’Œæ‹–æ‹½åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', () => {
            // DOM å…ƒç´ ç¼“å­˜
            const cache = {
                slideContainer: document.querySelector('.slide-container'),
                slideTrack: document.querySelector('.slide-track'),
                slideItems: document.querySelectorAll('.slide-item'),
                slideControls: document.querySelectorAll('.slide-control'),
                indicators: document.querySelectorAll('.indicator'),
                toolItems: document.querySelectorAll('.tool-item'),
                draggableElements: document.querySelectorAll('.draggable')
            };
            
            // çŠ¶æ€å˜é‡
            let currentSlideIndex = 0;
            
            // å®ç°roast-teaé¡µé¢çš„æ¨ªå‘æ»‘åŠ¨åŠŸèƒ½
            function initSlideFeatures() {
                if (!cache.slideContainer || !cache.slideTrack) return;
                
                // è®¡ç®—æ¯ä¸ªæ»‘åŠ¨é¡¹çš„å®½åº¦
                function getSlideWidth() {
                    return cache.slideContainer.offsetWidth;
                }
                
                // ç§»åŠ¨åˆ°æŒ‡å®šçš„æ»‘åŠ¨é¡¹
                function goToSlide(index) {
                    // è¾¹ç•Œæ£€æŸ¥
                    const safeIndex = Math.max(0, Math.min(index, cache.slideItems.length - 1));
                    
                    if (currentSlideIndex === safeIndex) return; // æ— éœ€ç§»åŠ¨
                    
                    currentSlideIndex = safeIndex;
                    const slideWidth = getSlideWidth();
                    cache.slideTrack.style.transform = `translateX(-${safeIndex * slideWidth}px)`;
                    
                    // æ›´æ–°æŒ‡ç¤ºå™¨çŠ¶æ€
                    cache.indicators.forEach((indicator, i) => {
                        const isActive = i === safeIndex;
                        indicator.classList.toggle('active', isActive);
                        indicator.setAttribute('aria-selected', isActive.toString());
                    });
                    
                    // åŒæ­¥å·¥å…·é€‰æ‹©çŠ¶æ€
                    cache.toolItems.forEach((item, i) => {
                        item.classList.toggle('active', i === safeIndex);
                    });
                    
                    // è®¾ç½®å½“å‰æ´»åŠ¨æ»‘å—çš„å¯è®¿é—®æ€§
                    cache.slideItems.forEach((item, i) => {
                        item.setAttribute('aria-hidden', (i !== safeIndex).toString());
                    });
                }
                
                // åˆå§‹åŒ–æ»‘åŠ¨çŠ¶æ€
                cache.slideItems.forEach((item, i) => {
                    item.setAttribute('aria-hidden', (i !== currentSlideIndex).toString());
                });
                
                // æŒ‰é’®æ§åˆ¶äº‹ä»¶
                cache.slideControls.forEach(control => {
                    control.addEventListener('click', () => {
                        goToSlide(control.classList.contains('prev') ? 
                            currentSlideIndex - 1 : currentSlideIndex + 1);
                    });
                });
                
                // æŒ‡ç¤ºå™¨ç‚¹å‡»äº‹ä»¶
                cache.indicators.forEach(indicator => {
                    indicator.addEventListener('click', () => {
                        const index = parseInt(indicator.dataset.index, 10);
                        goToSlide(index);
                    });
                    
                    // é”®ç›˜æ§åˆ¶
                    indicator.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            const index = parseInt(indicator.dataset.index, 10);
                            goToSlide(index);
                        }
                    });
                });
                
                // æ‹–åŠ¨ç›¸å…³å˜é‡
                let isDragging = false;
                let startX;
                let startScrollLeft;
                
                // æ‹–åŠ¨å¼€å§‹
                function startDrag(e) {
                    isDragging = true;
                    startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
                    startScrollLeft = -parseInt(cache.slideTrack.style.transform.replace('translateX(-', '')) || 0;
                    
                    // ç§»é™¤è¿‡æ¸¡æ•ˆæœï¼Œå®ç°å¹³æ»‘æ‹–åŠ¨
                    cache.slideTrack.style.transition = 'none';
                    
                    // æ·»åŠ æ‹–åŠ¨æ—¶çš„è§†è§‰åé¦ˆ
                    cache.slideContainer.style.cursor = 'grabbing';
                    cache.slideContainer.style.userSelect = 'none';
                }
                
                // æ‹–åŠ¨ä¸­
                function drag(e) {
                    if (!isDragging) return;
                    e.preventDefault(); // é˜²æ­¢é¡µé¢æ»šåŠ¨
                    
                    const x = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
                    const walk = (x - startX) * 1.5; // æ‹–åŠ¨é€Ÿåº¦å› å­
                    const newScrollLeft = startScrollLeft + walk;
                    
                    // è¾¹ç•Œæ£€æŸ¥
                    const maxScrollLeft = (cache.slideItems.length - 1) * getSlideWidth();
                    const boundedScrollLeft = Math.max(0, Math.min(newScrollLeft, maxScrollLeft));
                    
                    cache.slideTrack.style.transform = `translateX(-${boundedScrollLeft}px)`;
                }
                
                // æ‹–åŠ¨ç»“æŸ
                function endDrag() {
                    if (!isDragging) return;
                    isDragging = false;
                    
                    // æ¢å¤è¿‡æ¸¡æ•ˆæœ
                    cache.slideTrack.style.transition = `transform var(--slide-transition)`;
                    cache.slideContainer.style.cursor = '';
                    cache.slideContainer.style.userSelect = '';
                    
                    // è®¡ç®—åº”è¯¥åˆ‡æ¢åˆ°å“ªä¸ªå¹»ç¯ç‰‡
                    const slideWidth = getSlideWidth();
                    const currentPosition = -parseInt(cache.slideTrack.style.transform.replace('translateX(-', '')) || 0;
                    const nearestSlideIndex = Math.round(currentPosition / slideWidth);
                    
                    goToSlide(nearestSlideIndex);
                }
                
                // è§¦æ‘¸æ»‘åŠ¨æ”¯æŒ
                cache.slideContainer.addEventListener('touchstart', startDrag, { passive: false });
                cache.slideContainer.addEventListener('touchmove', drag, { passive: false });
                cache.slideContainer.addEventListener('touchend', endDrag);
                
                // é¼ æ ‡æ‹–åŠ¨æ”¯æŒï¼ˆæ¨¡æ‹Ÿæ‰‹æŒ‡æ»‘åŠ¨ï¼‰
                cache.slideContainer.addEventListener('mousedown', startDrag);
                document.addEventListener('mousemove', drag);
                document.addEventListener('mouseup', endDrag);
                document.addEventListener('mouseleave', endDrag); // é˜²æ­¢é¼ æ ‡ç§»å‡ºé¡µé¢æ—¶çŠ¶æ€å¡ä½
                
                // è¿”å›goToSlideå‡½æ•°ä¾›å¤–éƒ¨ä½¿ç”¨
                return goToSlide;
            }
            
            // åˆå§‹åŒ–æ»‘åŠ¨åŠŸèƒ½
            const goToSlide = initSlideFeatures();
            
            // ä¸ºå¯æ‹–æ‹½å…ƒç´ æ·»åŠ æ‹–æ‹½åŠŸèƒ½
            function initDraggableElements() {
                cache.draggableElements.forEach(element => {
                    let isDraggingElement = false;
                    let offsetX, offsetY;
                    
                    function startElementDrag(e) {
                        isDraggingElement = true;
                        
                        const rect = element.getBoundingClientRect();
                        const touchOrMouseEvent = e.type === 'mousedown' ? e : e.touches[0];
                        
                        offsetX = touchOrMouseEvent.clientX - rect.left;
                        offsetY = touchOrMouseEvent.clientY - rect.top;
                        
                        // ç¡®ä¿å…ƒç´ å¯ä»¥è¢«æ‹–åŠ¨
                        element.style.position = 'relative';
                        element.style.zIndex = '100';
                        element.style.willChange = 'transform';
                    }
                    
                    function dragElement(e) {
                        if (!isDraggingElement) return;
                        e.preventDefault();
                        
                        const touchOrMouseEvent = e.type === 'mousemove' ? e : e.touches[0];
                        
                        const parentRect = element.parentElement.getBoundingClientRect();
                        const elementRect = element.getBoundingClientRect();
                        
                        // è®¡ç®—æ–°ä½ç½®å¹¶è¿›è¡Œè¾¹ç•Œæ£€æŸ¥
                        let newLeft = touchOrMouseEvent.clientX - parentRect.left - offsetX;
                        let newTop = touchOrMouseEvent.clientY - parentRect.top - offsetY;
                        
                        // è¾¹ç•Œæ£€æŸ¥ - ç¡®ä¿å…ƒç´ ä¸ä¼šè¢«æ‹–å‡ºçˆ¶å®¹å™¨
                        newLeft = Math.max(0, Math.min(newLeft, parentRect.width - elementRect.width));
                        newTop = Math.max(0, Math.min(newTop, parentRect.height - elementRect.height));
                        
                        element.style.left = `${newLeft}px`;
                        element.style.top = `${newTop}px`;
                    }
                    
                    function endElementDrag() {
                        if (!isDraggingElement) return;
                        isDraggingElement = false;
                        element.style.willChange = '';
                    }
                    
                    // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    element.addEventListener('mousedown', startElementDrag);
                    element.addEventListener('touchstart', startElementDrag, { passive: false });
                    document.addEventListener('mousemove', dragElement);
                    document.addEventListener('touchmove', dragElement, { passive: false });
                    document.addEventListener('mouseup', endElementDrag);
                    document.addEventListener('touchend', endElementDrag);
                    document.addEventListener('mouseleave', endElementDrag); // é˜²æ­¢é¼ æ ‡ç§»å‡ºé¡µé¢æ—¶çŠ¶æ€å¡ä½
                    
                    // åŸç”Ÿæ‹–æ”¾æ”¯æŒ
                    element.addEventListener('dragstart', (e) => {
                        e.dataTransfer.setData('text/plain', 'dragging');
                    });
                });
            }
            
            // åˆå§‹åŒ–å¯æ‹–æ‹½å…ƒç´ 
            initDraggableElements();
            
            // ä½¿ç”¨äº‹ä»¶å§”æ‰˜å¤„ç†å·¥å…·é€‰æ‹©
            document.querySelector('.tool-selection')?.addEventListener('click', (e) => {
                if (e.target.classList.contains('tool-item')) {
                    const toolIndex = Array.from(cache.toolItems).indexOf(e.target);
                    
                    // åŒæ­¥å·¥å…·é€‰æ‹©ä¸æ»‘åŠ¨ä½ç½®
                    if (goToSlide) {
                        goToSlide(toolIndex);
                    }
                }
            });
            
            // å·¥å…·é€‰æ‹©é”®ç›˜æ”¯æŒ
            cache.toolItems.forEach((item, index) => {
                item.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        if (goToSlide) {
                            goToSlide(index);
                        }
                    }
                });
            });
            
            // ä¼˜åŒ–å“åº”å¼å¤„ç†
            function handleResize() {
                // é‡æ–°è®¡ç®—æ»‘åŠ¨ä½ç½®
                if (cache.slideTrack && goToSlide) {
                    // ä¿å­˜å½“å‰ç´¢å¼•å¹¶é‡æ–°å®šä½ï¼Œç¡®ä¿åœ¨çª—å£è°ƒæ•´åä½ç½®æ­£ç¡®
                    const tempIndex = currentSlideIndex;
                    currentSlideIndex = -1; // å¼ºåˆ¶é‡æ–°è®¡ç®—
                    goToSlide(tempIndex);
                }
            }
            
            // ä½¿ç”¨èŠ‚æµå‡½æ•°ä¼˜åŒ–çª—å£è°ƒæ•´äº‹ä»¶
            function throttle(func, delay) {
                let lastCall = 0;
                return function(...args) {
                    const now = new Date().getTime();
                    if (now - lastCall < delay) return;
                    lastCall = now;
                    return func(...args);
                };
            }
            
            window.addEventListener('resize', throttle(handleResize, 200));
            handleResize(); // åˆå§‹è°ƒç”¨
        });
    </script>
</body>
</html>